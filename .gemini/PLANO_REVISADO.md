# ğŸš€ Ayra SaaS - Plano REVISADO (Simplificado)

## ğŸ“‹ MudanÃ§as Importantes

### âŒ O QUE NÃƒO VAMOS FAZER
- âŒ Magic Link / OTP
- âŒ MigraÃ§Ã£o completa para Supabase
- âŒ MÃºltiplas tabelas (perfil, dieta, refeiÃ§Ãµes)
- âŒ Supabase Storage para fotos
- âŒ SincronizaÃ§Ã£o complexa

### âœ… O QUE VAMOS FAZER
- âœ… Login simples com email + nome
- âœ… Apenas 1 tabela: `ayra_cadastro`
- âœ… Dados do app ficam no localStorage
- âœ… Supabase sÃ³ para verificar plano (free/premium)
- âœ… PWA instalÃ¡vel
- âœ… NotificaÃ§Ãµes (opcional)

---

## ğŸ¯ FASE 1: Login e VerificaÃ§Ã£o de Plano

### Estrutura da Tabela (JÃ¡ Existe)

```sql
create table public.ayra_cadastro (
  id bigint generated by default as identity not null,
  nome text null,
  email text null,
  telefone text null,
  idade numeric null,
  problemas_de_saude text null,
  restricoes text null,
  objetivo text null,
  dificuldade text null,
  tem_nutri_ou_dieta text null,
  peso_altura text null,
  info_extra text null,
  plano text null,  -- 'premium' ou NULL/vazio (freemium)
  created_at timestamp default now(),
  updated_at timestamp default now()
);
```

### Fluxo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TELA DE LOGIN                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Novo usuÃ¡rio?                                      â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  Nome: [________________]                          â”‚    â”‚
â”‚  â”‚  Email: [________________]                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  [ Cadastrar ]                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  JÃ¡ tem conta?                                      â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  Email: [________________]                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  [ Entrar ]                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LÃ³gica de AutenticaÃ§Ã£o

#### Cadastro (Novo UsuÃ¡rio)
1. UsuÃ¡rio preenche nome + email
2. Sistema verifica se email jÃ¡ existe
3. Se nÃ£o existe:
   - Insere na tabela `ayra_cadastro`
   - Campos: nome, email
   - Plano: NULL (freemium por padrÃ£o)
4. Salva no localStorage:
   - `ayra_user_email`
   - `ayra_user_name`
   - `ayra_user_id`
   - `ayra_user_premium` (false)
5. Redireciona para onboarding

#### Login (UsuÃ¡rio Existente)
1. UsuÃ¡rio preenche email
2. Sistema busca na tabela `ayra_cadastro`
3. Se encontrar:
   - Verifica campo `plano`
   - Se `plano === 'premium'` â†’ premium = true
   - Se `plano === NULL ou vazio` â†’ premium = false
4. Salva no localStorage:
   - `ayra_user_email`
   - `ayra_user_name`
   - `ayra_user_id`
   - `ayra_user_premium` (true/false)
5. Redireciona para dashboard

---

## ğŸ¯ FASE 2: SincronizaÃ§Ã£o de Dados do App

### O Que Sincronizar

Quando o usuÃ¡rio preenche dados no app (AnamnesePage), vamos **ATUALIZAR** a linha dele na tabela `ayra_cadastro`:

```typescript
// Campos que vÃªm da AnamnesePage
{
  telefone: string,
  idade: number,
  problemas_de_saude: string,
  restricoes: string,
  objetivo: string,
  dificuldade: string,
  tem_nutri_ou_dieta: string,
  peso_altura: string,
  info_extra: string
}
```

### EstratÃ©gia HÃ­brida

**localStorage (MantÃ©m):**
- âœ… RefeiÃ§Ãµes registradas
- âœ… Dieta personalizada
- âœ… HistÃ³rico de Ã¡gua/sono/exercÃ­cio
- âœ… Fotos (base64)
- âœ… Metas nutricionais

**Supabase (Atualiza):**
- âœ… Dados pessoais (telefone, idade, etc)
- âœ… VerificaÃ§Ã£o de plano (premium/free)

### Por Que Essa EstratÃ©gia?

1. **Simplicidade:** NÃ£o precisa migrar tudo
2. **Performance:** localStorage Ã© instantÃ¢neo
3. **Offline:** App funciona sem internet
4. **Privacidade:** Dados sensÃ­veis ficam no dispositivo
5. **Escalabilidade:** FÃ¡cil migrar depois se precisar

---

## ğŸ¯ FASE 3: PWA (MantÃ©m do Plano Original)

- âœ… Manifest.json
- âœ… Service Worker
- âœ… Ãcones
- âœ… Tela de instalaÃ§Ã£o

---

## ğŸ¯ FASE 4: IntegraÃ§Ã£o com IA (MantÃ©m)

- âœ… BotÃ£o "Enviar Dados"
- âœ… Coleta dados do localStorage
- âœ… Envia JSON para API

---

## ğŸ¯ FASE 5: NotificaÃ§Ãµes (Opcional)

- âœ… Push notifications
- âœ… Lembretes automÃ¡ticos

---

## ğŸ“ Checklist de ImplementaÃ§Ã£o

### FASE 1: Login (AGORA)

#### Backend (Supabase)
- [ ] Verificar se tabela `ayra_cadastro` existe
- [ ] Adicionar coluna `plano` se nÃ£o existir:
```sql
ALTER TABLE ayra_cadastro 
ADD COLUMN IF NOT EXISTS plano TEXT;
```
- [ ] Adicionar coluna `created_at` se nÃ£o existir:
```sql
ALTER TABLE ayra_cadastro 
ADD COLUMN IF NOT EXISTS created_at TIMESTAMP DEFAULT NOW();
```

#### Frontend
- [ ] Atualizar `AuthPage.tsx`:
  - Remover login demo
  - Adicionar formulÃ¡rio de cadastro (nome + email)
  - Adicionar formulÃ¡rio de login (email)
  - Implementar lÃ³gica de verificaÃ§Ã£o
  - Toast para feedback

- [ ] Criar `src/lib/supabaseAuth.ts`:
  - `registerUser(nome, email)` â†’ INSERT
  - `loginUser(email)` â†’ SELECT
  - `checkUserPlan(email)` â†’ SELECT plano

- [ ] Atualizar `AuthContext.tsx`:
  - Gerenciar estado de autenticaÃ§Ã£o
  - Salvar dados no localStorage
  - Verificar plano (premium/free)

**Tempo estimado:** 2-3 horas

---

### FASE 2: SincronizaÃ§Ã£o de Dados (DEPOIS)

- [ ] Atualizar `AnamnesePage.tsx`:
  - Ao salvar, tambÃ©m UPDATE no Supabase
  - Campos: telefone, idade, problemas_de_saude, etc
  - Manter salvamento no localStorage

- [ ] Criar funÃ§Ã£o `updateUserData()`:
  ```typescript
  async function updateUserData(userId: number, data: UserData) {
    const { error } = await supabase
      .from('ayra_cadastro')
      .update({
        telefone: data.telefone,
        idade: data.idade,
        problemas_de_saude: data.problemas_de_saude,
        restricoes: data.restricoes,
        objetivo: data.objetivo,
        dificuldade: data.dificuldade,
        tem_nutri_ou_dieta: data.tem_nutri_ou_dieta,
        peso_altura: data.peso_altura,
        info_extra: data.info_extra,
        updated_at: new Date().toISOString()
      })
      .eq('id', userId);
    
    if (error) throw error;
  }
  ```

**Tempo estimado:** 1-2 horas

---

## ğŸ”„ Fluxo Completo

### 1. Primeiro Acesso (Novo UsuÃ¡rio)
```
UsuÃ¡rio abre app
  â†“
VÃª tela de login
  â†“
Clica "Cadastrar"
  â†“
Preenche nome + email
  â†“
Sistema insere na tabela (plano = NULL)
  â†“
Salva no localStorage (premium = false)
  â†“
Redireciona para onboarding
  â†“
Preenche dados pessoais
  â†“
Salva no localStorage + UPDATE no Supabase
  â†“
Usa o app normalmente (tudo no localStorage)
```

### 2. UsuÃ¡rio Compra Premium
```
VocÃª recebe pagamento
  â†“
Insere/atualiza na planilha Supabase
  â†“
UPDATE ayra_cadastro SET plano = 'premium' WHERE email = 'user@email.com'
  â†“
UsuÃ¡rio faz logout/login
  â†“
Sistema detecta plano = 'premium'
  â†“
Salva no localStorage (premium = true)
  â†“
App desbloqueia features premium
```

### 3. Retorno ao App
```
UsuÃ¡rio abre app
  â†“
Verifica localStorage
  â†“
Se tem email salvo:
  â†“
  Faz SELECT no Supabase
  â†“
  Atualiza status premium
  â†“
  Redireciona para dashboard
SenÃ£o:
  â†“
  Mostra tela de login
```

---

## ğŸ¨ Tela de Login (Design)

```tsx
// AuthPage.tsx (Simplificado)

<div className="min-h-screen bg-background">
  {/* Logo */}
  <div className="text-center pt-12 pb-8">
    <h1 className="text-4xl font-bold text-primary">Ayra</h1>
    <p className="text-text-muted">NutriÃ§Ã£o Inteligente</p>
  </div>

  {/* Tabs */}
  <div className="flex gap-4 px-6 mb-6">
    <button onClick={() => setTab('login')}>Entrar</button>
    <button onClick={() => setTab('register')}>Cadastrar</button>
  </div>

  {/* FormulÃ¡rio de Login */}
  {tab === 'login' && (
    <form onSubmit={handleLogin}>
      <input 
        type="email" 
        placeholder="Seu email"
        required
      />
      <button type="submit">Entrar</button>
    </form>
  )}

  {/* FormulÃ¡rio de Cadastro */}
  {tab === 'register' && (
    <form onSubmit={handleRegister}>
      <input 
        type="text" 
        placeholder="Seu nome"
        required
      />
      <input 
        type="email" 
        placeholder="Seu email"
        required
      />
      <button type="submit">Cadastrar</button>
    </form>
  )}
</div>
```

---

## ğŸ“Š ComparaÃ§Ã£o: Antes vs Depois

### Antes (Plano Original)
- âŒ Magic Link (complexo)
- âŒ 9 tabelas no Supabase
- âŒ MigraÃ§Ã£o completa de dados
- âŒ Supabase Storage
- âŒ SincronizaÃ§Ã£o bidirecional
- â±ï¸ 39-55 horas

### Depois (Plano Revisado)
- âœ… Login simples (email)
- âœ… 1 tabela no Supabase
- âœ… Dados ficam no localStorage
- âœ… Apenas verificaÃ§Ã£o de plano
- âœ… UPDATE opcional de dados pessoais
- â±ï¸ **8-12 horas**

---

## ğŸš€ Vantagens do Plano Revisado

1. **Mais Simples:** Menos cÃ³digo, menos bugs
2. **Mais RÃ¡pido:** 8-12h vs 39-55h
3. **Mais Barato:** Sem custos de storage
4. **Mais Privado:** Dados sensÃ­veis no dispositivo
5. **Offline First:** App funciona sem internet
6. **FÃ¡cil Migrar:** Se precisar, migra depois

---

## â±ï¸ Novo Cronograma

### Hoje (2-3 horas)
- âœ… Implementar login/cadastro
- âœ… VerificaÃ§Ã£o de plano
- âœ… Testes

### AmanhÃ£ (1-2 horas)
- âœ… SincronizaÃ§Ã£o de dados pessoais
- âœ… Testes

### PrÃ³xima Semana (5-7 horas)
- âœ… PWA
- âœ… IntegraÃ§Ã£o com IA
- âœ… NotificaÃ§Ãµes (opcional)

**Total: 8-12 horas** ğŸ‰

---

## ğŸ¯ PrÃ³ximo Passo

**Vou implementar FASE 1 (Login) agora?**

Vou criar:
1. `src/lib/supabaseAuth.ts` (funÃ§Ãµes de auth)
2. Atualizar `AuthPage.tsx` (nova UI)
3. Atualizar `AuthContext.tsx` (gerenciar estado)
4. Testes

**Posso comeÃ§ar?** ğŸš€
