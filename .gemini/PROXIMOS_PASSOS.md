# üéØ Pr√≥ximos Passos - Configurar Supabase

## ‚úÖ O Que J√° Funciona

1. **‚úÖ Interface de Login/Cadastro**
   - Design moderno com tabs
   - Formul√°rios funcionando
   - Toast notifications
   - Loading states

2. **‚úÖ C√≥digo de Autentica√ß√£o**
   - `supabaseAuth.ts` criado
   - `AuthPage.tsx` atualizado
   - `AuthContext.tsx` simplificado
   - `App.tsx` com rotas protegidas

3. **‚úÖ Fluxo de Navega√ß√£o**
   - Cadastro ‚Üí Onboarding
   - Login ‚Üí Dashboard
   - Prote√ß√£o de rotas

## ‚ùå O Que Precisa Configurar (URGENTE)

### Erro Atual: 406 (Not Acceptable)

**Causa:** Tabela `ayra_cadastro` n√£o tem permiss√µes RLS configuradas

**Solu√ß√£o:** Executar SQL no Supabase

---

## üìã Passo a Passo para Resolver

### 1. Acessar Supabase Dashboard

1. Abra: https://supabase.com/dashboard
2. Fa√ßa login
3. Selecione seu projeto Ayra

### 2. Abrir SQL Editor

1. No menu lateral, clique em **"SQL Editor"**
2. Clique em **"New query"**

### 3. Copiar e Executar SQL

1. Abra o arquivo: `.gemini/supabase_setup.sql`
2. Copie TODO o conte√∫do
3. Cole no SQL Editor do Supabase
4. Clique em **"Run"** (ou pressione Ctrl+Enter)

### 4. Verificar Sucesso

Voc√™ deve ver mensagens como:
```
ALTER TABLE
CREATE INDEX
ALTER TABLE
CREATE POLICY
CREATE POLICY
CREATE POLICY
```

### 5. Testar no App

1. Volte para http://localhost:5173/login
2. Tente cadastrar um novo usu√°rio
3. Agora N√ÉO deve aparecer erro 406
4. Deve redirecionar para /onboarding

---

## üîç Como Verificar se Funcionou

### Teste 1: Cadastro
```
1. Acesse /login
2. Clique em "Cadastrar"
3. Preencha:
   - Nome: "Jo√£o Silva"
   - Email: "joao@teste.com"
4. Clique "Criar conta gr√°tis"
5. Deve mostrar toast verde: "Conta criada com sucesso!"
6. Deve redirecionar para /onboarding
```

### Teste 2: Login
```
1. Acesse /login
2. Clique em "Entrar"
3. Preencha:
   - Email: "joao@teste.com"
4. Clique "Entrar"
5. Deve mostrar toast verde: "Bem-vindo de volta, Jo√£o Silva!"
6. Deve redirecionar para /inicio
```

### Teste 3: Verificar no Supabase
```
1. V√° em "Table Editor" no Supabase
2. Selecione tabela "ayra_cadastro"
3. Deve ver o usu√°rio cadastrado:
   - nome: "Jo√£o Silva"
   - email: "joao@teste.com"
   - plano: NULL
```

---

## üêõ Se Ainda Houver Erros

### Erro: "relation ayra_cadastro does not exist"
**Solu√ß√£o:** A tabela n√£o existe. Crie manualmente:

```sql
CREATE TABLE ayra_cadastro (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT,
  email TEXT UNIQUE,
  telefone TEXT,
  idade NUMERIC,
  problemas_de_saude TEXT,
  restricoes TEXT,
  objetivo TEXT,
  dificuldade TEXT,
  tem_nutri_ou_dieta TEXT,
  peso_altura TEXT,
  info_extra TEXT,
  plano TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### Erro: "duplicate key value violates unique constraint"
**Causa:** Email j√° existe
**Solu√ß√£o:** Use outro email ou delete o registro antigo

### Erro: "permission denied for table ayra_cadastro"
**Causa:** RLS n√£o configurado corretamente
**Solu√ß√£o:** Execute novamente o `supabase_setup.sql`

---

## üìä Estrutura Final da Tabela

Ap√≥s executar o SQL, sua tabela deve ter:

| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| id | bigint | ID √∫nico (auto-incremento) |
| nome | text | Nome completo |
| email | text | Email (√∫nico) |
| telefone | text | Telefone (opcional) |
| idade | numeric | Idade (opcional) |
| problemas_de_saude | text | Problemas de sa√∫de |
| restricoes | text | Restri√ß√µes alimentares |
| objetivo | text | Objetivo (emagrecer, ganhar massa, etc) |
| dificuldade | text | Dificuldade relatada |
| tem_nutri_ou_dieta | text | Tem nutricionista/dieta |
| peso_altura | text | Peso e altura |
| info_extra | text | Informa√ß√µes extras |
| **plano** | text | **'premium' ou NULL (freemium)** |
| created_at | timestamp | Data de cria√ß√£o |
| updated_at | timestamp | Data de atualiza√ß√£o |

---

## üîê Pol√≠ticas RLS Criadas

1. **Allow public read access**
   - Permite SELECT (buscar por email)
   - Necess√°rio para login

2. **Allow public insert**
   - Permite INSERT (cadastro)
   - Necess√°rio para registro

3. **Allow public update**
   - Permite UPDATE (atualizar dados)
   - Necess√°rio para AnamnesePage

**‚ö†Ô∏è IMPORTANTE:** Estas pol√≠ticas s√£o p√∫blicas (sem autentica√ß√£o). OK para MVP, mas em produ√ß√£o voc√™ deve implementar Supabase Auth.

---

## ‚úÖ Checklist Final

Antes de continuar para pr√≥xima fase:

- [ ] SQL executado no Supabase
- [ ] Tabela `ayra_cadastro` existe
- [ ] Coluna `plano` existe
- [ ] RLS habilitado
- [ ] 3 pol√≠ticas criadas
- [ ] Cadastro funciona sem erro 406
- [ ] Login funciona sem erro 406
- [ ] Dados aparecem no Supabase Table Editor

---

## üöÄ Pr√≥xima Fase (Depois de Resolver)

Ap√≥s configurar o Supabase, vamos:

1. **Atualizar AnamnesePage**
   - Salvar dados pessoais no Supabase
   - Manter localStorage tamb√©m

2. **Implementar PWA**
   - Manifest.json
   - Service Worker
   - √çcones

3. **Integra√ß√£o com IA**
   - Bot√£o "Enviar Dados"
   - JSON com perfil completo

---

**Me avise quando executar o SQL e eu testo junto com voc√™!** üéØ
